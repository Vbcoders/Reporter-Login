<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mahabubabad Updates</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    /* Styles for layout and buttons */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Roboto', sans-serif; background-color: #f4f4f9; color: #333; }
    header { background-color: #004aad; color: #fff; padding: 20px 10%; text-align: center; }
    header h1 { font-size: 2.5rem; }
    nav { background-color: #002f6c; padding: 10px 10%; display: flex; justify-content: space-between; }
    nav a { color: #fff; text-decoration: none; font-size: 1rem; margin: 0 15px; }
    .container { padding: 20px 10%; }
    .news-list { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
    .news-item { background-color: #fff; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); }
    .news-item img { width: 100%; height: 200px; object-fit: cover; }
    .news-item .content { padding: 15px; }
    .news-item h3 { font-size: 1.2rem; margin-bottom: 10px; }
    .news-item p { font-size: 0.9rem; color: #555; }
    .news-item button { margin-top: 10px; padding: 10px; color: white; background-color: #004aad; border: none; border-radius: 5px; cursor: pointer; }
    footer { background-color: #002f6c; color: #fff; text-align: center; padding: 10px 0; }
  </style>
</head>
<body>
  <!-- Header -->
  <header>
    <h1>Mahabubabad Updates</h1>
    <p>Your Trusted Source for Local News</p>
  </header>

  <!-- Navigation -->
  <nav>
    <a href="#">Home</a>
    <a href="reporterProfile.html">Profile</a>
  </nav>

  <!-- News Section -->
  <div class="container">
    <section class="news-list" id="news-list"></section>
  </div>

  <!-- Footer -->
  <footer>
    <p>&copy; 2025 Mahabubabad Updates. All Rights Reserved.</p>
  </footer>

  <!-- Firebase Scripts -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDJrOF5heJBnrXh2rmoa2Tto5H9d9mfJUQ",
      authDomain: "uploadnewsapp.firebaseapp.com",
      databaseURL: "https://uploadnewsapp-default-rtdb.firebaseio.com",
      projectId: "uploadnewsapp",
      storageBucket: "uploadnewsapp.appspot.com",
      messagingSenderId: "582380420692",
      appId: "1:582380420692:web:bf476455fe2a4189d7f7c1",
      measurementId: "G-Z5KPQ70JZ9"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();
    const storage = firebase.storage();

    let showUnpublished = false;

    // Check User and Allow Toggle for "Vikas Prince"
    auth.onAuthStateChanged((user) => {
      if (user) {
        const userName = user.displayName;
        if (userName === 'Vikas Prince') {
          const toggleButton = document.createElement('button');
          toggleButton.innerText = 'Show Unpublished News';
          toggleButton.style.marginBottom = '20px';
          toggleButton.style.backgroundColor = 'lightgreen';
          toggleButton.style.padding = '10px';
          toggleButton.style.color = 'black';
          toggleButton.style.fontWeight = 'bold';
          toggleButton.onclick = () => {
            showUnpublished = !showUnpublished;
            toggleButton.innerText = showUnpublished ? 'Show Published News' : 'Show Unpublished News';
            fetchNews();
          };
          document.querySelector('.container').insertBefore(toggleButton, document.getElementById('news-list'));
        }
      }
    });

    // Fetch Published or Unpublished News
    async function fetchNews() {
      const newsList = document.getElementById('news-list');
      newsList.innerHTML = '';

      // Fetch news and filter out rejected news
      const snapshot = await db.ref('news')
        .orderByChild('published')
        .equalTo(showUnpublished ? false : true)
        .once('value');

      snapshot.forEach(childSnapshot => {
        const data = childSnapshot.val();
        const newsId = childSnapshot.key;

        // Skip rejected news
        if (data.rejected) {
          return;  // Skip adding this news to the list
        }

        newsList.innerHTML += `
          <div class="news-item">
            <img src="${data.imageUrl}" alt="${data.title}">
            <div class="content">
              <h3>${data.title}</h3>
              <p>${data.content}...</p>
              <small>Location: ${data.location} | Updated: ${new Date(data.updated_at).toLocaleString()}</small>
              <div class="reporter-info">
                <img src="${data.reporterProfilePic}" alt="${data.reporterName}" style="width: 30px; height: 30px; border-radius: 50%; margin-right: 10px;">
                <span>by ${data.reporterName}</span>
              </div>
              ${
                showUnpublished
                  ? `<button onclick="publishNews('${newsId}')">Publish</button>
                     <button onclick="rejectNews('${newsId}')">Reject</button>`
                  : `<button onclick="removeNews('${newsId}')">Remove from Published</button>`
              }
            </div>
          </div>
        `;
      });
    }

    // Publish News
    async function publishNews(newsId) {
      const newsRef = db.ref(`news/${newsId}`);
      await newsRef.update({ published: true, updated_at: firebase.database.ServerValue.TIMESTAMP });
      alert('News has been published!');
      fetchNews();
    }

    // Reject News
    async function rejectNews(newsId) {
      const newsRef = db.ref(`news/${newsId}`);
      await newsRef.update({ rejected: true, published: false, updated_at: firebase.database.ServerValue.TIMESTAMP });
      alert('News has been rejected!');
      fetchNews();
    }

    // Remove News
    async function removeNews(newsId) {
      const newsRef = db.ref(`news/${newsId}`);
      await newsRef.remove();
      alert('News has been removed!');
      fetchNews();
    }

    // Initially, load the published news by default
    fetchNews();
  </script>
</body>
</html>
